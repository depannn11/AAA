<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XTE APIs</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'xte-orange': '#FF4500',
                        'xte-black': '#0A0A0A'
                    },
                    fontFamily: {
                        'mono': ['JetBrains Mono', 'monospace'],
                        'sans': ['Plus Jakarta Sans', 'sans-serif'],
                        'display': ['Space Grotesk', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #FF4500; }
        body { background: #ffffff; color: #0a0a0a; scroll-behavior: smooth; }
        .mobile-menu { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); transform: translateX(100%); }
        .mobile-menu.active { transform: translateX(0); }
        .card-xte { background: #fff; border: 1px solid rgba(0,0,0,0.08); transition: all 0.4s ease; border-radius: 2rem; overflow: hidden; }
        .card-xte:hover { border-color: #FF4500; transform: translateY(-5px); box-shadow: 0 20px 40px rgba(255, 69, 0, 0.05); }
        .method-tag { font-size: 9px; font-weight: 900; padding: 4px 12px; border-radius: 6px; }
        .get-tag { background: #000; color: #fff; }
        .post-tag { background: #FF4500; color: #fff; }
        .curl-box { background: #0A0A0A; border-radius: 12px; padding: 12px; position: relative; margin-bottom: 16px; border: 1px solid rgba(255, 69, 0, 0.1); }
        .history-item { border-left: 2px solid #FF4500; background: rgba(0,0,0,0.02); padding: 8px 12px; margin-top: 8px; border-radius: 0 8px 8px 0; transition: 0.2s; cursor: pointer; }
        .history-item:hover { background: rgba(255, 69, 0, 0.05); }
        @keyframes slideUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .animate-up { animation: slideUp 0.5s ease forwards; }
    </style>
</head>
<body class="font-sans text-[14px]">

    <nav class="fixed top-0 w-full h-16 bg-white/80 backdrop-blur-md border-b border-black/5 z-[100] px-6">
        <div class="max-w-7xl mx-auto h-full flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-black rounded-lg flex items-center justify-center">
                    <i class="material-icons text-xte-orange text-lg">bolt</i>
                </div>
                <span class="font-black text-lg tracking-tighter uppercase font-display">XTE <span class="text-xte-orange">APIS</span></span>
            </div>
            <button id="menuBtn" class="p-2 hover:bg-black/5 rounded-lg transition-all">
                <i class="material-icons">menu</i>
            </button>
        </div>
    </nav>

    <div id="sideMenu" class="mobile-menu fixed inset-0 bg-black z-[200] p-10 flex flex-col">
        <div class="flex justify-end mb-10">
            <button id="closeBtn" class="p-2 bg-white/10 rounded-full text-white"><i class="material-icons">close</i></button>
        </div>
        <div class="flex flex-col gap-6">
            <a href="/" class="text-white text-2xl font-black uppercase tracking-widest hover:text-xte-orange transition-colors">Home</a>
            <a href="/docs" class="text-white text-2xl font-black uppercase tracking-widest text-xte-orange">Docs</a>
            <div class="h-[1px] bg-white/10 my-4"></div>
            <a href="/dev" class="text-white/60 text-lg font-bold uppercase hover:text-white transition-colors">Developer</a>
        </div>
    </div>

    <main class="max-w-7xl mx-auto px-6 pt-32">
        <section class="mb-12 animate-up text-center md:text-left">
            <h2 class="text-5xl font-black font-display tracking-tighter mb-4">ENGINE <span class="text-xte-orange">TERMINAL.</span></h2>
            <p class="text-black/40 font-bold uppercase text-[10px] tracking-[0.4em]">Integrated API Debugger & Documentation</p>
        </section>

        <div id="apiContent" class="grid grid-cols-1 lg:grid-cols-2 gap-8 pb-20">
            </div>
    </main>

    <div id="toast" class="fixed top-20 left-1/2 -translate-x-1/2 -translate-y-20 opacity-0 transition-all duration-500 z-[100]">
        <div class="bg-black text-white px-6 py-3 rounded-xl shadow-2xl flex items-center gap-3">
            <i class="material-icons text-xte-orange text-sm">bolt</i>
            <span class="text-[10px] font-black uppercase tracking-widest italic">System Updated</span>
        </div>
    </div>

    <script>
        const historyStore = {};

        function updateCurl(key, method, path) {
            const form = document.getElementById(`f-${key}`);
            const curlDisplay = document.getElementById(`curl-text-${key}`);
            const fd = new FormData(form);
            let fullUrl = window.location.origin + path;
            
            if (method.toUpperCase() === 'GET') {
                const params = new URLSearchParams();
                for (const [k, v] of fd.entries()) if (v) params.append(k, v);
                if (params.toString()) fullUrl += '?' + params.toString();
            }
            curlDisplay.textContent = `curl -X ${method.toUpperCase()} "${fullUrl}"`;
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.querySelector('span').textContent = msg;
            t.classList.remove('-translate-y-20', 'opacity-0');
            setTimeout(() => t.classList.add('-translate-y-20', 'opacity-0'), 2500);
        }

        async function trigger(cIdx, eIdx, method, path) {
            const key = `${cIdx}-${eIdx}`;
            const form = document.getElementById(`f-${key}`);
            const resultBox = document.getElementById(`r-${key}`);
            const resultContent = document.getElementById(`rc-${key}`);
            const historyList = document.getElementById(`h-${key}`);
            const btn = form.querySelector('button');
            
            resultBox.classList.remove('hidden');
            resultContent.innerHTML = `<div class="p-8 flex justify-center"><div class="w-6 h-6 border-2 border-xte-orange border-t-transparent rounded-full animate-spin"></div></div>`;
            btn.disabled = true;

            const fd = new FormData(form);
            let url = path;
            const cfg = { method: method.toUpperCase() };

            if (cfg.method === 'GET') {
                const p = new URLSearchParams();
                for (const [k, v] of fd.entries()) if(v) p.append(k, v);
                if (p.toString()) url += (url.includes('?') ? '&' : '?') + p.toString();
            } else { cfg.body = fd; }

            try {
                const start = Date.now();
                const res = await fetch(url, cfg);
                const time = Date.now() - start;
                const text = await res.text();
                let displayData = text;

                try { displayData = JSON.stringify(JSON.parse(text), null, 2); } catch(e) {}

                // Save to history
                if(!historyStore[key]) historyStore[key] = [];
                const histItem = { time: new Date().toLocaleTimeString(), status: res.status, data: displayData };
                historyStore[key].unshift(histItem);
                if(historyStore[key].length > 3) historyStore[key].pop();

                // Update UI
                renderHistory(key);
                resultContent.innerHTML = `
                    <div class="flex items-center justify-between px-4 py-2 border-b border-black/5 bg-gray-50">
                        <span class="text-[9px] font-black text-green-600 uppercase">LATEST: ${res.status} OK â€¢ ${time}ms</span>
                        <button onclick="navigator.clipboard.writeText(\`${displayData.replace(/`/g, '\\`')}\`); showToast('RESULT COPIED')" class="text-[9px] font-black uppercase text-xte-orange">Copy JSON</button>
                    </div>
                    <pre class="p-4 text-[10px] font-mono overflow-auto max-h-64 bg-xte-black text-green-400"><code>${displayData}</code></pre>
                `;
            } catch (e) {
                resultContent.innerHTML = `<div class="p-6 text-center text-red-500 text-[10px] font-black uppercase">Request Failed: ${e.message}</div>`;
            } finally {
                btn.disabled = false;
            }
        }

        function renderHistory(key) {
            const container = document.getElementById(`h-${key}`);
            if(!historyStore[key]) return;
            container.innerHTML = `<p class="text-[8px] font-black text-black/20 uppercase mb-2 tracking-widest">Recent Activity</p>` + 
                historyStore[key].map((item, idx) => `
                <div class="history-item flex justify-between items-center" onclick="loadHistory('${key}', ${idx})">
                    <span class="text-[9px] font-bold text-black/60">${item.time}</span>
                    <span class="text-[9px] font-black text-xte-orange">${item.status}</span>
                </div>
            `).join('');
        }

        function loadHistory(key, idx) {
            const item = historyStore[key][idx];
            const resultContent = document.getElementById(`rc-${key}`);
            resultContent.innerHTML = `
                <div class="flex items-center justify-between px-4 py-2 border-b border-black/5 bg-gray-50">
                    <span class="text-[9px] font-black text-black/40 uppercase tracking-widest">RECOVERY: ${item.time}</span>
                    <button onclick="navigator.clipboard.writeText(\`${item.data.replace(/`/g, '\\`')}\`); showToast('HISTORY COPIED')" class="text-[9px] font-black uppercase text-xte-orange">Copy</button>
                </div>
                <pre class="p-4 text-[10px] font-mono overflow-auto max-h-64 bg-xte-black text-blue-400"><code>${item.data}</code></pre>
            `;
            showToast('HISTORY LOADED');
        }

        // --- Same Init Logic as before but with History Container ---
        async function init() {
            const container = document.getElementById('apiContent');
            try {
                const res = await fetch('/openapi.json');
                const data = await res.json();
                let h = '';
                
                Object.entries(data.paths).forEach(([path, methods], cIdx) => {
                    Object.entries(methods).forEach(([m, it], eIdx) => {
                        const key = `${cIdx}-${eIdx}`;
                        const params = it.parameters || [];
                        h += `
                            <div class="api-card-wrapper animate-up">
                                <div class="card-xte flex flex-col h-full">
                                    <div class="p-8 flex-1">
                                        <div class="flex justify-between items-center mb-6">
                                            <span class="method-tag ${m.toUpperCase() === 'GET' ? 'get-tag' : 'post-tag'}">${m.toUpperCase()}</span>
                                            <span class="text-[10px] font-black text-black/20 tracking-tighter uppercase font-display italic">Endpoint Architecture</span>
                                        </div>
                                        <h3 class="text-[13px] font-mono font-bold text-black mb-1">${path}</h3>
                                        <p class="text-[10px] text-black/40 font-bold uppercase mb-6">${it.summary || 'Production Ready'}</p>
                                        
                                        <div class="curl-box mb-6">
                                            <code id="curl-text-${key}" class="text-[9px] text-gray-400 font-mono break-all leading-tight italic">curl -X ${m.toUpperCase()} "${window.location.origin}${path}"</code>
                                        </div>

                                        <form id="f-${key}" class="space-y-4 mb-6">
                                            ${params.map(p => `
                                                <div class="space-y-1">
                                                    <label class="text-[9px] font-black text-black/30 uppercase tracking-widest">${p.name}</label>
                                                    <input type="text" name="${p.name}" oninput="updateCurl('${key}', '${m}', '${path}')" class="w-full bg-black/5 rounded-xl px-4 py-3 text-[11px] outline-none focus:bg-white border border-transparent focus:border-black/5 transition-all">
                                                </div>
                                            `).join('')}
                                            <button type="button" onclick="trigger(${cIdx}, ${eIdx}, '${m}', '${path}')" class="w-full bg-black text-white py-4 rounded-2xl text-[10px] font-black uppercase tracking-[0.2em] hover:bg-xte-orange hover:shadow-lg hover:shadow-xte-orange/20 transition-all">
                                                Execute Engine
                                            </button>
                                        </form>

                                        <div id="h-${key}" class="space-y-1"></div>
                                    </div>
                                    <div id="r-${key}" class="hidden border-t border-black/5 bg-white">
                                        <div id="rc-${key}"></div>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                });
                container.innerHTML = h;
            } catch (e) { container.innerHTML = `<p class="col-span-full text-center py-20 font-black uppercase text-xte-orange">Offline / System Error</p>`; }
        }

        const menuBtn = document.getElementById('menuBtn');
        const closeBtn = document.getElementById('closeBtn');
        const sideMenu = document.getElementById('sideMenu');
        menuBtn.onclick = () => sideMenu.classList.add('active');
        closeBtn.onclick = () => sideMenu.classList.remove('active');

        window.onload = init;
    </script>
</body>
</html>
